version: "3.9"
services:
  api:
    container_name: sf-academy-api
    build:
      context: $PWD
      dockerfile: api/Dockerfile
    working_dir: /home/node/app/api
    ports:
      - ${API_PORT}:${API_PORT}
    environment:
      NODE_ENV: ${NODE_ENV}
      API_PORT: ${API_PORT}
      EXCHANGE_PORT: ${EXCHANGE_PORT}
      EXCHANGE_HOST: ${EXCHANGE_HOST}
      USERS_PORT: ${USERS_PORT}
      USERS_HOST: ${USERS_HOST}
      TOKEN_SECRET: ${TOKEN_SECRET}
    entrypoint: node build/server/src/index.js
  exchange:
    container_name: sf-academy-exchange
    build:
      context: $PWD
      dockerfile: exchange/Dockerfile
    working_dir: /home/node/app/exchange
    expose:
      - ${EXCHANGE_PORT}
    environment:
      NODE_ENV: ${NODE_ENV}
      EXCHANGE_PORT: ${EXCHANGE_PORT}
    entrypoint: node build/server/src/index.js
  users:
    container_name: sf-academy-users
    depends_on:
      - db
    build:
      context: $PWD
      dockerfile: users/Dockerfile
    working_dir: /home/node/app/users
    expose:
      - ${USERS_PORT}
    environment:
      NODE_ENV: ${NODE_ENV}
      USERS_PORT: ${USERS_PORT}
      TOKEN_SECRET: ${TOKEN_SECRET}
      DB_NAME: ${DB_NAME}
      DB_PORT: ${DB_PORT}
      DB_HOST: ${DB_HOST}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
    entrypoint: node build/server/src/index.js
  db:
    container_name: sf-academy-db
    image: postgres:14-alpine
    environment:
      POSTGRES_PORT: ${DB_PORT}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_DB: ${DB_NAME}
    expose:
      - ${DB_PORT}
    